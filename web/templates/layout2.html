<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>GoSight Dashboard</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="stylesheet" href="/css/output.css" />
    <link
      href="https://unpkg.com/flowbite@1.7.0/dist/flowbite.min.css"
      rel="stylesheet"
    />
  </head>
  <body
    class="bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-white font-sans antialiased"
  >
    <div class="flex min-h-screen">
      <!-- Sidebar -->
      <aside
        class="w-64 bg-gray-900 text-gray-100 p-6 flex flex-col justify-between border-r border-gray-800"
      >
        <div>
          <div class="flex items-center justify-between mb-10">
            <h1 class="text-xl font-bold text-blue-400">GoSight</h1>
            <span
              class="text-xs bg-gray-800 text-gray-300 font-semibold px-2 py-1 rounded"
              >DEV</span
            >
          </div>
          <nav class="space-y-1" id="sidebar-nav">
            <a
              href="/"
              class="block px-3 py-2 rounded-lg text-sm hover:bg-gray-800"
              >Dashboard</a
            >
            <a
              href="/metrics"
              class="block px-3 py-2 rounded-lg text-sm hover:bg-gray-800"
              >Metrics</a
            >
            <a
              href="/agents"
              class="block px-3 py-2 rounded-lg text-sm hover:bg-gray-800"
              >Agents</a
            >
            <a
              href="/endpoints"
              class="block px-3 py-2 rounded-lg text-sm bg-gray-800"
              >Endpoints</a
            >
            <a
              href="/logs"
              class="block px-3 py-2 rounded-lg text-sm hover:bg-gray-800"
              >Logs</a
            >
            <a
              href="/config"
              class="block px-3 py-2 rounded-lg text-sm hover:bg-gray-800"
              >Config</a
            >
          </nav>
        </div>
        <div class="text-gray-500 text-sm">
          <p>Version: 1.0.0</p>
        </div>
      </aside>

      <!-- Main content -->
      <div class="flex-1 flex flex-col">
        <!-- Top Nav -->
        <header
          class="bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 px-6 py-3 shadow"
        >
          <div class="flex items-center justify-between">
            <h2 class="text-gray-700 dark:text-gray-200 text-sm font-medium">
              {{ block "title" . }}Dashboard{{ end }}
            </h2>
            <div class="flex items-center gap-4">
              <p class="text-sm text-gray-500 dark:text-gray-300">
                Last updated: <span id="last-updated">--</span>
              </p>
              <button
                id="darkToggle"
                class="text-sm text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600 px-2 py-1 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700"
              >
                Toggle Dark Mode
              </button>
            </div>
          </div>
        </header>

        <!-- Page Content -->
        <main class="flex-1 p-6 w-full">{{ block "content" . }}{{ end }}</main>
      </div>
    </div>

    {{ block "scripts" . }}
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/flowbite@1.7.0/dist/flowbite.min.js"></script>
    <script>
      const charts = {};

      const renderMiniCharts = () => {
        new Chart(document.getElementById("miniCpuChart"), {
          type: "line",
          data: {
            labels: ["1m", "2m", "3m", "4m", "5m"],
            datasets: [
              {
                data: [12, 18, 14, 20, 17],
                borderColor: "#3b82f6",
                backgroundColor: "rgba(59, 130, 246, 0.1)",
                tension: 0.4,
                fill: true,
                pointRadius: 0,
              },
            ],
          },
          options: {
            plugins: { legend: { display: false } },
            scales: { y: { display: true }, x: { display: true } },
            elements: { line: { borderWidth: 2 } },
            responsive: true,
          },
        });

        new Chart(document.getElementById("miniMemoryChart"), {
          type: "line",
          data: {
            labels: ["1m", "2m", "3m", "4m", "5m"],
            datasets: [
              {
                data: [6.2, 6.3, 6.1, 6.4, 6.6],
                borderColor: "#10b981",
                backgroundColor: "rgba(16, 185, 129, 0.1)",
                tension: 0.4,
                fill: true,
                pointRadius: 0,
              },
            ],
          },
          options: {
            plugins: { legend: { display: false } },
            scales: { y: { display: true }, x: { display: true } },
            elements: { line: { borderWidth: 2 } },
            responsive: true,
          },
        });

        new Chart(document.getElementById("miniDiskChart"), {
          type: "line",
          data: {
            labels: ["1m", "2m", "3m", "4m", "5m"],
            datasets: [
              {
                data: [110, 135, 90, 120, 140],
                borderColor: "#f59e0b",
                backgroundColor: "rgba(245, 158, 11, 0.1)",
                tension: 0.4,
                fill: true,
                pointRadius: 0,
              },
            ],
          },
          options: {
            plugins: { legend: { display: false } },
            scales: { y: { display: true }, x: { display: true } },
            elements: { line: { borderWidth: 2 } },
            responsive: true,
          },
        });
      };

      const renderCpuCharts = () => {
        if (charts.cpuUsageChart) return;

        charts.cpuUsageChart = new Chart(
          document.getElementById("cpuUsageChart"),
          {
            type: "line",
            data: {
              labels: [
                "10m",
                "9m",
                "8m",
                "7m",
                "6m",
                "5m",
                "4m",
                "3m",
                "2m",
                "1m",
              ],
              datasets: [
                {
                  label: "CPU Usage %",
                  data: [20, 23, 21, 25, 28, 26, 30, 27, 24, 22],
                  borderColor: "#3b82f6",
                  backgroundColor: "rgba(59, 130, 246, 0.1)",
                  fill: true,
                  tension: 0.3,
                  pointRadius: 2,
                },
              ],
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              scales: {
                y: {
                  beginAtZero: true,
                  ticks: {
                    callback: (val) => val + "%",
                  },
                },
              },
              plugins: {
                legend: {
                  labels: { color: "#4B5563" },
                },
              },
            },
          }
        );

        charts.cpuDonutChart = new Chart(
          document.getElementById("cpuDonutChart"),
          {
            type: "doughnut",
            data: {
              labels: ["User", "System", "Idle", "Nice"],
              datasets: [
                {
                  label: "CPU Time",
                  data: [13400, 7300, 28000, 1200],
                  backgroundColor: ["#3b82f6", "#10b981", "#9ca3af", "#fbbf24"],
                  borderWidth: 1,
                },
              ],
            },
            options: {
              responsive: true,
              plugins: {
                legend: {
                  position: "bottom",
                  labels: { color: "#4B5563" },
                },
              },
            },
          }
        );
      };

      document.addEventListener("DOMContentLoaded", () => {
        renderMiniCharts(); // immediately load mini charts
        renderCpuCharts(); // preload CPU tab
      });

      document
        .getElementById("cpu-tab")
        ?.addEventListener("click", renderCpuCharts);
    </script>

    {{ end }}
  </body>
</html>
