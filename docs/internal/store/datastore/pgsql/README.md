<!-- Code generated by gomarkdoc. DO NOT EDIT -->

# pgstore

```go
import "github.com/aaronlmathis/gosight-server/internal/store/datastore/pgsql"
```

Package pgstore implements the userstore.Store interface using PostgreSQL

Package pgstore provides PostgreSQL storage implementation for GoSight process data.

This file implements process\-specific storage operations including:

- Bulk insertion of process snapshots for efficient batch processing
- Individual process snapshot and detail insertion
- Flexible querying with filtering, sorting, and pagination
- JSON handling for process labels and metadata

The storage model separates process snapshots \(point\-in\-time system state\) from individual process details to optimize for both write performance and query flexibility. Process snapshots contain host metadata and timing information, while process\_info records contain the detailed process data.

## Index

- [type PGDataStore](<#PGDataStore>)
  - [func NewPGDataStore\(db \*sql.DB\) \*PGDataStore](<#NewPGDataStore>)
  - [func \(s \*PGDataStore\) Close\(\) error](<#PGDataStore.Close>)
  - [func \(s \*PGDataStore\) DeleteNetworkDeviceByID\(ctx context.Context, id string\) error](<#PGDataStore.DeleteNetworkDeviceByID>)
  - [func \(s \*PGDataStore\) DeleteTag\(ctx context.Context, endpointID, key string\) error](<#PGDataStore.DeleteTag>)
  - [func \(s \*PGDataStore\) GetAgentByHostname\(ctx context.Context, hostname string\) \(\*model.Agent, error\)](<#PGDataStore.GetAgentByHostname>)
  - [func \(s \*PGDataStore\) GetAgentByID\(ctx context.Context, id string\) \(\*model.Agent, error\)](<#PGDataStore.GetAgentByID>)
  - [func \(s \*PGDataStore\) GetAllNetworkDevices\(ctx context.Context\) \(\[\]\*model.NetworkDevice, error\)](<#PGDataStore.GetAllNetworkDevices>)
  - [func \(s \*PGDataStore\) GetAllTags\(ctx context.Context\) \(\[\]model.Tag, error\)](<#PGDataStore.GetAllTags>)
  - [func \(s \*PGDataStore\) GetContainerByID\(ctx context.Context, id string\) \(\*model.Container, error\)](<#PGDataStore.GetContainerByID>)
  - [func \(s \*PGDataStore\) GetNetworkDeviceByAddress\(ctx context.Context, address string\) \(\*model.NetworkDevice, error\)](<#PGDataStore.GetNetworkDeviceByAddress>)
  - [func \(s \*PGDataStore\) GetNetworkDevices\(ctx context.Context, filter \*model.NetworkDeviceFilter\) \(\[\]\*model.NetworkDevice, error\)](<#PGDataStore.GetNetworkDevices>)
  - [func \(s \*PGDataStore\) GetTags\(ctx context.Context, endpointID string\) \(map\[string\]string, error\)](<#PGDataStore.GetTags>)
  - [func \(s \*PGDataStore\) InsertFullProcessPayload\(ctx context.Context, payload \*model.ProcessPayload\) error](<#PGDataStore.InsertFullProcessPayload>)
  - [func \(s \*PGDataStore\) InsertProcessInfos\(ctx context.Context, snapshotID int64, payload \*model.ProcessPayload\) error](<#PGDataStore.InsertProcessInfos>)
  - [func \(s \*PGDataStore\) InsertProcessSnapshot\(ctx context.Context, snap \*model.ProcessPayload\) \(int64, error\)](<#PGDataStore.InsertProcessSnapshot>)
  - [func \(s \*PGDataStore\) ListAgents\(ctx context.Context\) \(\[\]\*model.Agent, error\)](<#PGDataStore.ListAgents>)
  - [func \(s \*PGDataStore\) ListContainers\(ctx context.Context\) \(\[\]\*model.Container, error\)](<#PGDataStore.ListContainers>)
  - [func \(s \*PGDataStore\) ListKeys\(ctx context.Context\) \(\[\]string, error\)](<#PGDataStore.ListKeys>)
  - [func \(s \*PGDataStore\) ListTags\(ctx context.Context, endpointID string\) \(map\[string\]string, error\)](<#PGDataStore.ListTags>)
  - [func \(s \*PGDataStore\) ListValues\(ctx context.Context, key string\) \(\[\]string, error\)](<#PGDataStore.ListValues>)
  - [func \(s \*PGDataStore\) QueryProcessInfos\(ctx context.Context, filter \*model.ProcessQueryFilter\) \(\[\]model.ProcessInfo, error\)](<#PGDataStore.QueryProcessInfos>)
  - [func \(s \*PGDataStore\) SetTags\(ctx context.Context, endpointID string, tags map\[string\]string\) error](<#PGDataStore.SetTags>)
  - [func \(s \*PGDataStore\) ToggleNetworkDeviceStatus\(ctx context.Context, id string\) error](<#PGDataStore.ToggleNetworkDeviceStatus>)
  - [func \(s \*PGDataStore\) UpsertAgent\(ctx context.Context, agent \*model.Agent\) error](<#PGDataStore.UpsertAgent>)
  - [func \(s \*PGDataStore\) UpsertContainer\(ctx context.Context, c \*model.Container\) error](<#PGDataStore.UpsertContainer>)
  - [func \(s \*PGDataStore\) UpsertNetworkDevice\(ctx context.Context, device \*model.NetworkDevice\) error](<#PGDataStore.UpsertNetworkDevice>)
  - [func \(s \*PGDataStore\) Write\(ctx context.Context, batches \[\]\*model.ProcessPayload\) error](<#PGDataStore.Write>)


<a name="PGDataStore"></a>
## type [PGDataStore](<https://github.com/aaronlmathis/gosight-server/blob/main/internal/store/datastore/pgsql/pgdatastore.go#L35-L37>)

Package pgstore implements the userstore.Store interface using PostgreSQL PGDataStore is a struct that represents a PostgreSQL data store It contains a pointer to the sql.DB object for database operations

```go
type PGDataStore struct {
    // contains filtered or unexported fields
}
```

<a name="NewPGDataStore"></a>
### func [NewPGDataStore](<https://github.com/aaronlmathis/gosight-server/blob/main/internal/store/datastore/pgsql/pgdatastore.go#L40>)

```go
func NewPGDataStore(db *sql.DB) *PGDataStore
```

New creates a new PGDataStore instance

<a name="PGDataStore.Close"></a>
### func \(\*PGDataStore\) [Close](<https://github.com/aaronlmathis/gosight-server/blob/main/internal/store/datastore/pgsql/pgdatastore.go#L46>)

```go
func (s *PGDataStore) Close() error
```

Close closes the database connection It checks if the db is not nil before attempting to close it

<a name="PGDataStore.DeleteNetworkDeviceByID"></a>
### func \(\*PGDataStore\) [DeleteNetworkDeviceByID](<https://github.com/aaronlmathis/gosight-server/blob/main/internal/store/datastore/pgsql/networkdevices.go#L260>)

```go
func (s *PGDataStore) DeleteNetworkDeviceByID(ctx context.Context, id string) error
```

DeleteNetworkDeviceByID deletes a network device by its ID

<a name="PGDataStore.DeleteTag"></a>
### func \(\*PGDataStore\) [DeleteTag](<https://github.com/aaronlmathis/gosight-server/blob/main/internal/store/datastore/pgsql/tags.go#L105>)

```go
func (s *PGDataStore) DeleteTag(ctx context.Context, endpointID, key string) error
```

DeleteTag removes a specific tag for a given endpoint ID.

<a name="PGDataStore.GetAgentByHostname"></a>
### func \(\*PGDataStore\) [GetAgentByHostname](<https://github.com/aaronlmathis/gosight-server/blob/main/internal/store/datastore/pgsql/tracker.go#L132>)

```go
func (s *PGDataStore) GetAgentByHostname(ctx context.Context, hostname string) (*model.Agent, error)
```

GetAgentByHostname retrieves an agent by its hostname

<a name="PGDataStore.GetAgentByID"></a>
### func \(\*PGDataStore\) [GetAgentByID](<https://github.com/aaronlmathis/gosight-server/blob/main/internal/store/datastore/pgsql/tracker.go#L82>)

```go
func (s *PGDataStore) GetAgentByID(ctx context.Context, id string) (*model.Agent, error)
```

GetAgentByAgentID retrieves an agent by its agent\_id This is used for the agent to check in with the server

<a name="PGDataStore.GetAllNetworkDevices"></a>
### func \(\*PGDataStore\) [GetAllNetworkDevices](<https://github.com/aaronlmathis/gosight-server/blob/main/internal/store/datastore/pgsql/networkdevices.go#L34>)

```go
func (s *PGDataStore) GetAllNetworkDevices(ctx context.Context) ([]*model.NetworkDevice, error)
```

GetNetworkDevices returns all network devices from the database

<a name="PGDataStore.GetAllTags"></a>
### func \(\*PGDataStore\) [GetAllTags](<https://github.com/aaronlmathis/gosight-server/blob/main/internal/store/datastore/pgsql/tags.go#L53>)

```go
func (s *PGDataStore) GetAllTags(ctx context.Context) ([]model.Tag, error)
```



<a name="PGDataStore.GetContainerByID"></a>
### func \(\*PGDataStore\) [GetContainerByID](<https://github.com/aaronlmathis/gosight-server/blob/main/internal/store/datastore/pgsql/tracker.go#L347>)

```go
func (s *PGDataStore) GetContainerByID(ctx context.Context, id string) (*model.Container, error)
```

GetContainerByID retrieves a container by its container\_id

<a name="PGDataStore.GetNetworkDeviceByAddress"></a>
### func \(\*PGDataStore\) [GetNetworkDeviceByAddress](<https://github.com/aaronlmathis/gosight-server/blob/main/internal/store/datastore/pgsql/networkdevices.go#L184>)

```go
func (s *PGDataStore) GetNetworkDeviceByAddress(ctx context.Context, address string) (*model.NetworkDevice, error)
```

GetNetworkDeviceByAddress looks up a single NetworkDevice by its IP/hostname. Returns \(nil, nil\) if no matching device is found.

<a name="PGDataStore.GetNetworkDevices"></a>
### func \(\*PGDataStore\) [GetNetworkDevices](<https://github.com/aaronlmathis/gosight-server/blob/main/internal/store/datastore/pgsql/networkdevices.go#L80>)

```go
func (s *PGDataStore) GetNetworkDevices(ctx context.Context, filter *model.NetworkDeviceFilter) ([]*model.NetworkDevice, error)
```



<a name="PGDataStore.GetTags"></a>
### func \(\*PGDataStore\) [GetTags](<https://github.com/aaronlmathis/gosight-server/blob/main/internal/store/datastore/pgsql/tags.go#L34>)

```go
func (s *PGDataStore) GetTags(ctx context.Context, endpointID string) (map[string]string, error)
```

GetTags retrieves all tags for a given endpoint ID.

<a name="PGDataStore.InsertFullProcessPayload"></a>
### func \(\*PGDataStore\) [InsertFullProcessPayload](<https://github.com/aaronlmathis/gosight-server/blob/main/internal/store/datastore/pgsql/processes.go#L110>)

```go
func (s *PGDataStore) InsertFullProcessPayload(ctx context.Context, payload *model.ProcessPayload) error
```

InsertFullProcessPayload inserts a complete process payload into the database. This is a convenience method that combines snapshot creation with process detail insertion in a single operation. It first creates a process snapshot and then inserts all associated process information records.

<a name="PGDataStore.InsertProcessInfos"></a>
### func \(\*PGDataStore\) [InsertProcessInfos](<https://github.com/aaronlmathis/gosight-server/blob/main/internal/store/datastore/pgsql/processes.go#L152>)

```go
func (s *PGDataStore) InsertProcessInfos(ctx context.Context, snapshotID int64, payload *model.ProcessPayload) error
```

InsertProcessInfos inserts multiple process information records associated with a snapshot. Each process record includes detailed information such as PID, CPU/memory usage, command line, executable path, and custom labels. The insertion is performed within a transaction to ensure data consistency.

<a name="PGDataStore.InsertProcessSnapshot"></a>
### func \(\*PGDataStore\) [InsertProcessSnapshot](<https://github.com/aaronlmathis/gosight-server/blob/main/internal/store/datastore/pgsql/processes.go#L122>)

```go
func (s *PGDataStore) InsertProcessSnapshot(ctx context.Context, snap *model.ProcessPayload) (int64, error)
```

InsertProcessSnapshot inserts a new process snapshot into the database. A process snapshot represents a point\-in\-time capture of system process state, including metadata about the host, agent, and collection timestamp. Returns the generated snapshot ID for linking associated process details.

<a name="PGDataStore.ListAgents"></a>
### func \(\*PGDataStore\) [ListAgents](<https://github.com/aaronlmathis/gosight-server/blob/main/internal/store/datastore/pgsql/tracker.go#L184>)

```go
func (s *PGDataStore) ListAgents(ctx context.Context) ([]*model.Agent, error)
```

ListAgents retrieves all agents from the database This is used for the web UI to display all agents and for the agent to check in with the server

<a name="PGDataStore.ListContainers"></a>
### func \(\*PGDataStore\) [ListContainers](<https://github.com/aaronlmathis/gosight-server/blob/main/internal/store/datastore/pgsql/tracker.go#L307>)

```go
func (s *PGDataStore) ListContainers(ctx context.Context) ([]*model.Container, error)
```

ListContainers retrieves all containers from the database This is used for the web UI to display all containers and for the agent to check in with the server

<a name="PGDataStore.ListKeys"></a>
### func \(\*PGDataStore\) [ListKeys](<https://github.com/aaronlmathis/gosight-server/blob/main/internal/store/datastore/pgsql/tags.go#L116>)

```go
func (s *PGDataStore) ListKeys(ctx context.Context) ([]string, error)
```

ListKeys returns all unique tag keys

<a name="PGDataStore.ListTags"></a>
### func \(\*PGDataStore\) [ListTags](<https://github.com/aaronlmathis/gosight-server/blob/main/internal/store/datastore/pgsql/tags.go#L111>)

```go
func (s *PGDataStore) ListTags(ctx context.Context, endpointID string) (map[string]string, error)
```

ListTags retrieves all tags for a given endpoint ID.

<a name="PGDataStore.ListValues"></a>
### func \(\*PGDataStore\) [ListValues](<https://github.com/aaronlmathis/gosight-server/blob/main/internal/store/datastore/pgsql/tags.go#L135>)

```go
func (s *PGDataStore) ListValues(ctx context.Context, key string) ([]string, error)
```

ListValues returns all values for a given key

<a name="PGDataStore.QueryProcessInfos"></a>
### func \(\*PGDataStore\) [QueryProcessInfos](<https://github.com/aaronlmathis/gosight-server/blob/main/internal/store/datastore/pgsql/processes.go#L200>)

```go
func (s *PGDataStore) QueryProcessInfos(ctx context.Context, filter *model.ProcessQueryFilter) ([]model.ProcessInfo, error)
```

QueryProcessInfos retrieves process information based on the provided filter criteria. It supports filtering by endpoint, time range, resource usage thresholds, user, process IDs, and text searches in executable paths and command lines. Results can be sorted by various fields and paginated for large datasets.

<a name="PGDataStore.SetTags"></a>
### func \(\*PGDataStore\) [SetTags](<https://github.com/aaronlmathis/gosight-server/blob/main/internal/store/datastore/pgsql/tags.go#L75>)

```go
func (s *PGDataStore) SetTags(ctx context.Context, endpointID string, tags map[string]string) error
```

SetTags replaces all tags for a given endpoint ID with the provided tags.

<a name="PGDataStore.ToggleNetworkDeviceStatus"></a>
### func \(\*PGDataStore\) [ToggleNetworkDeviceStatus](<https://github.com/aaronlmathis/gosight-server/blob/main/internal/store/datastore/pgsql/networkdevices.go#L267>)

```go
func (s *PGDataStore) ToggleNetworkDeviceStatus(ctx context.Context, id string) error
```

ToggleNetworkDeviceStatus toggles the status \(enabled/disabled\) of a device by ID

<a name="PGDataStore.UpsertAgent"></a>
### func \(\*PGDataStore\) [UpsertAgent](<https://github.com/aaronlmathis/gosight-server/blob/main/internal/store/datastore/pgsql/tracker.go#L42>)

```go
func (s *PGDataStore) UpsertAgent(ctx context.Context, agent *model.Agent) error
```



<a name="PGDataStore.UpsertContainer"></a>
### func \(\*PGDataStore\) [UpsertContainer](<https://github.com/aaronlmathis/gosight-server/blob/main/internal/store/datastore/pgsql/tracker.go#L257>)

```go
func (s *PGDataStore) UpsertContainer(ctx context.Context, c *model.Container) error
```

UpsertContainer inserts or updates a container in the database This is used for the agent to check in with the server It also updates the last\_seen field to the current time and the status field to "Running" if the container is running or "Stopped" if the container is stopped UpsertContainer inserts or updates a container in the database

<a name="PGDataStore.UpsertNetworkDevice"></a>
### func \(\*PGDataStore\) [UpsertNetworkDevice](<https://github.com/aaronlmathis/gosight-server/blob/main/internal/store/datastore/pgsql/networkdevices.go#L224>)

```go
func (s *PGDataStore) UpsertNetworkDevice(ctx context.Context, device *model.NetworkDevice) error
```

UpsertNetworkDevice inserts a new network device or updates an existing one

<a name="PGDataStore.Write"></a>
### func \(\*PGDataStore\) [Write](<https://github.com/aaronlmathis/gosight-server/blob/main/internal/store/datastore/pgsql/processes.go#L49>)

```go
func (s *PGDataStore) Write(ctx context.Context, batches []*model.ProcessPayload) error
```

Write implements the BufferedDataStore interface for process payloads. It performs bulk insertion of process snapshots for efficient batch processing.

Generated by [gomarkdoc](<https://github.com/princjef/gomarkdoc>)
