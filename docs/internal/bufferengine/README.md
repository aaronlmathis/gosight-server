<!-- Code generated by gomarkdoc. DO NOT EDIT -->

# bufferengine

```go
import "github.com/aaronlmathis/gosight-server/internal/bufferengine"
```

File: gosight\-server/internal/bufferengine/databuffer.go Description: Package bufferengine provides a buffered data store implementation for writing process payloads to an underlying data store. It buffers the payloads in memory and flushes them to the underlying store when the buffer reaches a certain size or after a specified interval. The buffered data store is designed to improve performance by reducing the number of write operations to the underlying data store.

File: gosight\-server/internal/bufferengine/engine.go Description: Package bufferengine provides a buffered store engine for GoSight. It allows for writing data to multiple stores with a specified flush interval. The engine manages the lifecycle of the stores, including starting and stopping them. It also provides a mechanism for writing data to the stores and flushing the data at regular intervals. The engine is designed to be used in a concurrent environment, with support for multiple goroutines.

File: gosight\-server/internal/bufferengine/logbuffer.go Description: Package bufferengine provides a buffered log store implementation. The BufferedLogStore buffers log entries before writing them to the underlying log store. It supports a maximum buffer size and a flush interval. The buffer is protected by a mutex to ensure thread safety. The BufferedLogStore is designed to improve performance by reducing the number of write operations to the underlying log store.

File: gosight\-server/internal/bufferengine/metricbuffer.go Description: Package bufferengine provides a buffered metric store implementation. It buffers metric payloads before writing them to the underlying metric store. The BufferedMetricStore is designed to improve performance by reducing the number of write operations to the underlying metric store. The buffer is protected by a mutex to ensure thread safety. The BufferedMetricStore supports a maximum buffer size and a flush interval.

## Index

- [type BufferEngine](<#BufferEngine>)
  - [func NewBufferEngine\(ctx context.Context, flushInterval time.Duration, maxWorkers int\) \*BufferEngine](<#NewBufferEngine>)
  - [func \(e \*BufferEngine\) RegisterStore\(store BufferedStore\)](<#BufferEngine.RegisterStore>)
  - [func \(e \*BufferEngine\) Start\(\)](<#BufferEngine.Start>)
  - [func \(e \*BufferEngine\) Stop\(\)](<#BufferEngine.Stop>)
- [type BufferedDataStore](<#BufferedDataStore>)
  - [func NewBufferedDataStore\(ctx context.Context, name string, store datastore.DataStore, maxSize int, flushInterval time.Duration\) \*BufferedDataStore](<#NewBufferedDataStore>)
  - [func \(b \*BufferedDataStore\) Close\(\) error](<#BufferedDataStore.Close>)
  - [func \(b \*BufferedDataStore\) Flush\(\) error](<#BufferedDataStore.Flush>)
  - [func \(b \*BufferedDataStore\) Interval\(\) time.Duration](<#BufferedDataStore.Interval>)
  - [func \(b \*BufferedDataStore\) Name\(\) string](<#BufferedDataStore.Name>)
  - [func \(b \*BufferedDataStore\) Write\(payload \*model.ProcessPayload\) error](<#BufferedDataStore.Write>)
  - [func \(b \*BufferedDataStore\) WriteAny\(payload interface\{\}\) error](<#BufferedDataStore.WriteAny>)
- [type BufferedLogStore](<#BufferedLogStore>)
  - [func NewBufferedLogStore\(name string, store LogStore, maxSize int, flushInterval time.Duration\) \*BufferedLogStore](<#NewBufferedLogStore>)
  - [func \(b \*BufferedLogStore\) Close\(\) error](<#BufferedLogStore.Close>)
  - [func \(b \*BufferedLogStore\) Flush\(\) error](<#BufferedLogStore.Flush>)
  - [func \(b \*BufferedLogStore\) Interval\(\) time.Duration](<#BufferedLogStore.Interval>)
  - [func \(b \*BufferedLogStore\) Name\(\) string](<#BufferedLogStore.Name>)
  - [func \(b \*BufferedLogStore\) Write\(payload model.LogPayload\) error](<#BufferedLogStore.Write>)
  - [func \(b \*BufferedLogStore\) WriteAny\(payload interface\{\}\) error](<#BufferedLogStore.WriteAny>)
- [type BufferedMetricStore](<#BufferedMetricStore>)
  - [func NewBufferedMetricStore\(name string, store MetricStore, maxSize int, flushInterval time.Duration\) \*BufferedMetricStore](<#NewBufferedMetricStore>)
  - [func \(b \*BufferedMetricStore\) Close\(\) error](<#BufferedMetricStore.Close>)
  - [func \(b \*BufferedMetricStore\) Flush\(\) error](<#BufferedMetricStore.Flush>)
  - [func \(b \*BufferedMetricStore\) Interval\(\) time.Duration](<#BufferedMetricStore.Interval>)
  - [func \(b \*BufferedMetricStore\) Name\(\) string](<#BufferedMetricStore.Name>)
  - [func \(b \*BufferedMetricStore\) Write\(payload model.MetricPayload\) error](<#BufferedMetricStore.Write>)
  - [func \(b \*BufferedMetricStore\) WriteAny\(payload interface\{\}\) error](<#BufferedMetricStore.WriteAny>)
- [type BufferedStore](<#BufferedStore>)
- [type DataStore](<#DataStore>)
- [type LogStore](<#LogStore>)
- [type MetricStore](<#MetricStore>)


<a name="BufferEngine"></a>
## type [BufferEngine](<https://github.com/aaronlmathis/gosight-server/blob/main/internal/bufferengine/engine.go#L53-L59>)

BufferEngine is a struct that manages multiple buffered stores. It is responsible for starting and stopping the stores, as well as flushing the data at regular intervals.

```go
type BufferEngine struct {
    // contains filtered or unexported fields
}
```

<a name="NewBufferEngine"></a>
### func [NewBufferEngine](<https://github.com/aaronlmathis/gosight-server/blob/main/internal/bufferengine/engine.go#L66>)

```go
func NewBufferEngine(ctx context.Context, flushInterval time.Duration, maxWorkers int) *BufferEngine
```

NewBufferEngine creates a new BufferEngine instance. It takes a context, flush interval, and maximum number of workers as parameters. The flush interval is used to determine how often the data should be flushed to the stores. The maximum number of workers is used to limit the number of concurrent goroutines that can be used for flushing the data.

<a name="BufferEngine.RegisterStore"></a>
### func \(\*BufferEngine\) [RegisterStore](<https://github.com/aaronlmathis/gosight-server/blob/main/internal/bufferengine/engine.go#L79>)

```go
func (e *BufferEngine) RegisterStore(store BufferedStore)
```

RegisterStore registers a new buffered store with the BufferEngine. It adds the store to the list of stores managed by the engine. The store must implement the BufferedStore interface. The engine will manage the lifecycle of the store, including starting and stopping it. The store will be flushed at regular intervals as specified by the flush interval.

<a name="BufferEngine.Start"></a>
### func \(\*BufferEngine\) [Start](<https://github.com/aaronlmathis/gosight-server/blob/main/internal/bufferengine/engine.go#L89>)

```go
func (e *BufferEngine) Start()
```

Start starts the BufferEngine and its registered stores. It launches a goroutine for each store that will flush the data at regular intervals. The flush interval is determined by the store's Interval method. The engine will also listen for a cancellation signal from the context. When the context is cancelled, the engine will stop all stores and wait for them to finish flushing.

<a name="BufferEngine.Stop"></a>
### func \(\*BufferEngine\) [Stop](<https://github.com/aaronlmathis/gosight-server/blob/main/internal/bufferengine/engine.go#L123>)

```go
func (e *BufferEngine) Stop()
```

Stop stops the BufferEngine and all its registered stores. It waits for all background flush routines to finish before closing the stores. The engine will also log any errors encountered while closing the stores. This method should be called when the engine is no longer needed, such as during application shutdown.

<a name="BufferedDataStore"></a>
## type [BufferedDataStore](<https://github.com/aaronlmathis/gosight-server/blob/main/internal/bufferengine/databuffer.go#L54-L62>)

BufferedDataStore is a buffered implementation of the DataStore interface. It buffers process payloads in memory and flushes them to the underlying data store when the buffer reaches a certain size or after a specified interval. This helps to reduce the number of write operations and improve performance. The buffer is protected by a mutex to ensure thread safety.

```go
type BufferedDataStore struct {
    // contains filtered or unexported fields
}
```

<a name="NewBufferedDataStore"></a>
### func [NewBufferedDataStore](<https://github.com/aaronlmathis/gosight-server/blob/main/internal/bufferengine/databuffer.go#L69>)

```go
func NewBufferedDataStore(ctx context.Context, name string, store datastore.DataStore, maxSize int, flushInterval time.Duration) *BufferedDataStore
```

NewBufferedDataStore creates a new BufferedDataStore instance. It takes a context, a name for the data store, an underlying data store, a maximum buffer size, and a flush interval as parameters. The flush interval is the time duration after which the buffer will be flushed to the underlying data store, even if the buffer size has not reached the maximum.

<a name="BufferedDataStore.Close"></a>
### func \(\*BufferedDataStore\) [Close](<https://github.com/aaronlmathis/gosight-server/blob/main/internal/bufferengine/databuffer.go#L151>)

```go
func (b *BufferedDataStore) Close() error
```

Close closes the buffered data store. It flushes any remaining payloads in the buffer to the underlying data store and releases any resources held by the buffered data store. This method is called when the buffered data store is no longer needed. It is important to call this method to ensure that all data is written to the underlying data store before closing the application.

<a name="BufferedDataStore.Flush"></a>
### func \(\*BufferedDataStore\) [Flush](<https://github.com/aaronlmathis/gosight-server/blob/main/internal/bufferengine/databuffer.go#L125>)

```go
func (b *BufferedDataStore) Flush() error
```

Flush flushes the buffer to the underlying data store. It is called to ensure that any remaining payloads in the buffer are written to the underlying data store before closing the buffered data store. This method is protected by a mutex to ensure thread safety when accessing the buffer.

<a name="BufferedDataStore.Interval"></a>
### func \(\*BufferedDataStore\) [Interval](<https://github.com/aaronlmathis/gosight-server/blob/main/internal/bufferengine/databuffer.go#L88>)

```go
func (b *BufferedDataStore) Interval() time.Duration
```

Interval returns the flush interval of the buffered data store. This is the time duration after which the buffer will be flushed

<a name="BufferedDataStore.Name"></a>
### func \(\*BufferedDataStore\) [Name](<https://github.com/aaronlmathis/gosight-server/blob/main/internal/bufferengine/databuffer.go#L82>)

```go
func (b *BufferedDataStore) Name() string
```

Name returns the name of the buffered data store. This is used to identify the buffered data store in logs and metrics.

<a name="BufferedDataStore.Write"></a>
### func \(\*BufferedDataStore\) [Write](<https://github.com/aaronlmathis/gosight-server/blob/main/internal/bufferengine/databuffer.go#L110>)

```go
func (b *BufferedDataStore) Write(payload *model.ProcessPayload) error
```

Write writes a process payload to the buffered data store. It appends the payload to the buffer and checks if the buffer size has reached the maximum size. If it has, it calls the flushLocked method to flush the buffer to the underlying data store. This method is protected by a mutex to ensure thread safety when accessing the buffer.

<a name="BufferedDataStore.WriteAny"></a>
### func \(\*BufferedDataStore\) [WriteAny](<https://github.com/aaronlmathis/gosight-server/blob/main/internal/bufferengine/databuffer.go#L97>)

```go
func (b *BufferedDataStore) WriteAny(payload interface{}) error
```

WriteAny writes a process payload to the buffered data store. It takes an interface\{\} as a parameter and attempts to cast it to a \*model.ProcessPayload. If the cast is successful, it calls the Write method to add the payload to the buffer. If the cast fails, it returns an error indicating that the payload type is invalid. This method is used to provide a generic interface for writing different types of payloads,

<a name="BufferedLogStore"></a>
## type [BufferedLogStore](<https://github.com/aaronlmathis/gosight-server/blob/main/internal/bufferengine/logbuffer.go#L50-L57>)

BufferedLogStore is a buffered implementation of the LogStore interface. It buffers log entries in memory and flushes them to the underlying log store when the buffer reaches a certain size or after a specified interval.

```go
type BufferedLogStore struct {
    // contains filtered or unexported fields
}
```

<a name="NewBufferedLogStore"></a>
### func [NewBufferedLogStore](<https://github.com/aaronlmathis/gosight-server/blob/main/internal/bufferengine/logbuffer.go#L65>)

```go
func NewBufferedLogStore(name string, store LogStore, maxSize int, flushInterval time.Duration) *BufferedLogStore
```

NewBufferedLogStore creates a new BufferedLogStore instance. It initializes the buffer with a specified maximum size and flush interval. The flush interval determines how often the buffer is flushed to the underlying log store. The maximum size determines when the buffer is flushed. The BufferedLogStore is designed to improve performance by reducing the number of write operations to the underlying log store.

<a name="BufferedLogStore.Close"></a>
### func \(\*BufferedLogStore\) [Close](<https://github.com/aaronlmathis/gosight-server/blob/main/internal/bufferengine/logbuffer.go#L143>)

```go
func (b *BufferedLogStore) Close() error
```

Close closes the BufferedLogStore and flushes any remaining log entries in the buffer. It is called to ensure that all buffered log entries are written to the underlying log store before the BufferedLogStore is closed. The Close method is thread\-safe and uses a mutex to protect the buffer. It returns an error if the flush operation fails.

<a name="BufferedLogStore.Flush"></a>
### func \(\*BufferedLogStore\) [Flush](<https://github.com/aaronlmathis/gosight-server/blob/main/internal/bufferengine/logbuffer.go#L118>)

```go
func (b *BufferedLogStore) Flush() error
```

Flush flushes the buffer to the underlying log store. It is called to ensure that all buffered log entries are written to the store. The Flush method is thread\-safe and uses a mutex to protect the buffer. It returns an error if the flush operation fails.

<a name="BufferedLogStore.Interval"></a>
### func \(\*BufferedLogStore\) [Interval](<https://github.com/aaronlmathis/gosight-server/blob/main/internal/bufferengine/logbuffer.go#L84>)

```go
func (b *BufferedLogStore) Interval() time.Duration
```

Interval returns the flush interval of the BufferedLogStore. This is the time duration after which the buffer will be flushed to the underlying log store, even if the buffer size has not reached the maximum.

<a name="BufferedLogStore.Name"></a>
### func \(\*BufferedLogStore\) [Name](<https://github.com/aaronlmathis/gosight-server/blob/main/internal/bufferengine/logbuffer.go#L77>)

```go
func (b *BufferedLogStore) Name() string
```

Name returns the name of the BufferedLogStore. It is used to identify the store in logs and metrics.

<a name="BufferedLogStore.Write"></a>
### func \(\*BufferedLogStore\) [Write](<https://github.com/aaronlmathis/gosight-server/blob/main/internal/bufferengine/logbuffer.go#L103>)

```go
func (b *BufferedLogStore) Write(payload model.LogPayload) error
```

Write writes a log entry to the BufferedLogStore. It appends the entry to the buffer and checks if the buffer size has reached the maximum. If the buffer size exceeds the maximum, it flushes the buffer to the underlying log store. The Write method is thread\-safe and uses a mutex to protect the buffer.

<a name="BufferedLogStore.WriteAny"></a>
### func \(\*BufferedLogStore\) [WriteAny](<https://github.com/aaronlmathis/gosight-server/blob/main/internal/bufferengine/logbuffer.go#L91>)

```go
func (b *BufferedLogStore) WriteAny(payload interface{}) error
```

WriteAny writes a log entry to the BufferedLogStore. It takes an interface\{\} as a parameter and attempts to convert it to a LogPayload. If the conversion fails, it returns an error.

<a name="BufferedMetricStore"></a>
## type [BufferedMetricStore](<https://github.com/aaronlmathis/gosight-server/blob/main/internal/bufferengine/metricbuffer.go#L44-L51>)

BufferedMetricStore is a buffered implementation of the MetricStore interface. It buffers metric payloads in memory and flushes them to the underlying metric store when the buffer reaches a certain size or after a specified interval. The buffer is protected by a mutex to ensure thread safety. The BufferedMetricStore is designed to improve performance by reducing the number of write operations

```go
type BufferedMetricStore struct {
    // contains filtered or unexported fields
}
```

<a name="NewBufferedMetricStore"></a>
### func [NewBufferedMetricStore](<https://github.com/aaronlmathis/gosight-server/blob/main/internal/bufferengine/metricbuffer.go#L68>)

```go
func NewBufferedMetricStore(name string, store MetricStore, maxSize int, flushInterval time.Duration) *BufferedMetricStore
```

NewBufferedMetricStore creates a new BufferedMetricStore instance. It initializes the buffer with a specified maximum size and flush interval. The flush interval determines how often the buffer is flushed to the underlying metric store. The maximum size determines when the buffer is flushed. The BufferedMetricStore is designed to improve performance by reducing the number of write operations to the underlying metric store.

<a name="BufferedMetricStore.Close"></a>
### func \(\*BufferedMetricStore\) [Close](<https://github.com/aaronlmathis/gosight-server/blob/main/internal/bufferengine/metricbuffer.go#L148>)

```go
func (b *BufferedMetricStore) Close() error
```

Close closes the BufferedMetricStore and flushes any remaining buffered metric payloads. It is called to ensure that all buffered metric payloads are written to the underlying metric store. The Close method is thread\-safe and uses a mutex to protect the buffer. It returns an error if the flush operation fails. The Close method is typically called when the application is shutting down

<a name="BufferedMetricStore.Flush"></a>
### func \(\*BufferedMetricStore\) [Flush](<https://github.com/aaronlmathis/gosight-server/blob/main/internal/bufferengine/metricbuffer.go#L123>)

```go
func (b *BufferedMetricStore) Flush() error
```

Flush flushes the buffer to the underlying metric store. It is called to ensure that all buffered metric payloads are written to the store. The Flush method is thread\-safe and uses a mutex to protect the buffer. It returns an error if the flush operation fails.

<a name="BufferedMetricStore.Interval"></a>
### func \(\*BufferedMetricStore\) [Interval](<https://github.com/aaronlmathis/gosight-server/blob/main/internal/bufferengine/metricbuffer.go#L87>)

```go
func (b *BufferedMetricStore) Interval() time.Duration
```

Interval returns the flush interval of the BufferedMetricStore. This is the time duration after which the buffer will be flushed to the underlying metric store, even if the buffer size has not reached the maximum.

<a name="BufferedMetricStore.Name"></a>
### func \(\*BufferedMetricStore\) [Name](<https://github.com/aaronlmathis/gosight-server/blob/main/internal/bufferengine/metricbuffer.go#L80>)

```go
func (b *BufferedMetricStore) Name() string
```

Name returns the name of the BufferedMetricStore. It is used to identify the store in logs and metrics.

<a name="BufferedMetricStore.Write"></a>
### func \(\*BufferedMetricStore\) [Write](<https://github.com/aaronlmathis/gosight-server/blob/main/internal/bufferengine/metricbuffer.go#L108>)

```go
func (b *BufferedMetricStore) Write(payload model.MetricPayload) error
```

Write writes a metric payload to the buffered metric store. It appends the payload to the buffer and checks if the buffer size has reached the maximum. If the buffer size exceeds the maximum, it flushes the buffer to the underlying metric store. The Write method is thread\-safe and uses a mutex to protect the buffer. It returns an error if the flush operation fails.

<a name="BufferedMetricStore.WriteAny"></a>
### func \(\*BufferedMetricStore\) [WriteAny](<https://github.com/aaronlmathis/gosight-server/blob/main/internal/bufferengine/metricbuffer.go#L95>)

```go
func (b *BufferedMetricStore) WriteAny(payload interface{}) error
```

WriteAny writes a payload to the buffered metric store. It takes an interface\{\} as a parameter and attempts to convert it to a MetricPayload. If the conversion is successful, it writes the payload to the buffer. If the conversion fails, it returns an error.

<a name="BufferedStore"></a>
## type [BufferedStore](<https://github.com/aaronlmathis/gosight-server/blob/main/internal/bufferengine/engine.go#L43-L49>)

BufferedStore is an interface that defines the methods for a buffered store. It is used to abstract the underlying store implementation, allowing for different storage engines to be used \(e.g., file, database\). The BufferedStore interface defines methods for writing data, flushing the buffer, closing the store, and retrieving the store name and flush interval.

```go
type BufferedStore interface {
    WriteAny(payload interface{}) error
    Flush() error
    Close() error
    Name() string
    Interval() time.Duration
}
```

<a name="DataStore"></a>
## type [DataStore](<https://github.com/aaronlmathis/gosight-server/blob/main/internal/bufferengine/databuffer.go#L45-L47>)

DataStore is an interface that defines the methods for writing process payloads. It is used to abstract the underlying data store implementation, allowing for different storage engines to be used \(e.g., file, database\).

```go
type DataStore interface {
    Write(ctx context.Context, batches []*model.ProcessPayload) error
}
```

<a name="LogStore"></a>
## type [LogStore](<https://github.com/aaronlmathis/gosight-server/blob/main/internal/bufferengine/logbuffer.go#L43-L45>)

LogStore is an interface that defines the methods for writing log entries. It is used to abstract the underlying log store implementation, allowing for different storage engines to be used \(e.g., file, database\).

```go
type LogStore interface {
    Write(entries []model.LogPayload) error
}
```

<a name="MetricStore"></a>
## type [MetricStore](<https://github.com/aaronlmathis/gosight-server/blob/main/internal/bufferengine/metricbuffer.go#L58-L60>)

MetricStore is an interface that defines the methods for writing metric payloads. It is used to abstract the underlying metric store implementation, allowing for different storage engines to be used \(e.g., file, database\). The MetricStore interface defines methods for writing metric payloads, flushing the buffer, closing the store, and retrieving the store name and flush interval.

```go
type MetricStore interface {
    Write(payloads []model.MetricPayload) error
}
```

Generated by [gomarkdoc](<https://github.com/princjef/gomarkdoc>)
