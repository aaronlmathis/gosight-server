<!-- Code generated by gomarkdoc. DO NOT EDIT -->

# inmemory

```go
import "github.com/aaronlmathis/gosight-server/internal/cache/inmemory"
```

## Index

- [type ResourceCache](<#ResourceCache>)
  - [func NewResourceCache\(store resourcestore.ResourceStore, flushInterval time.Duration\) \*ResourceCache](<#NewResourceCache>)
  - [func \(c \*ResourceCache\) Clear\(\)](<#ResourceCache.Clear>)
  - [func \(c \*ResourceCache\) DeleteResource\(id string\) bool](<#ResourceCache.DeleteResource>)
  - [func \(c \*ResourceCache\) GetKinds\(\) \[\]string](<#ResourceCache.GetKinds>)
  - [func \(c \*ResourceCache\) GetResource\(id string\) \(\*model.Resource, bool\)](<#ResourceCache.GetResource>)
  - [func \(c \*ResourceCache\) GetResourceCount\(\) int](<#ResourceCache.GetResourceCount>)
  - [func \(c \*ResourceCache\) GetResourceCountByKind\(\) map\[string\]int](<#ResourceCache.GetResourceCountByKind>)
  - [func \(c \*ResourceCache\) GetResourcesByGroup\(group string\) \[\]\*model.Resource](<#ResourceCache.GetResourcesByGroup>)
  - [func \(c \*ResourceCache\) GetResourcesByKind\(kind string\) \[\]\*model.Resource](<#ResourceCache.GetResourcesByKind>)
  - [func \(c \*ResourceCache\) GetResourcesByLabels\(labels map\[string\]string\) \[\]\*model.Resource](<#ResourceCache.GetResourcesByLabels>)
  - [func \(c \*ResourceCache\) GetResourcesByParent\(parentID string\) \[\]\*model.Resource](<#ResourceCache.GetResourcesByParent>)
  - [func \(c \*ResourceCache\) GetResourcesByTags\(tags map\[string\]string\) \[\]\*model.Resource](<#ResourceCache.GetResourcesByTags>)
  - [func \(c \*ResourceCache\) GetStaleResources\(threshold time.Duration\) \[\]\*model.Resource](<#ResourceCache.GetStaleResources>)
  - [func \(c \*ResourceCache\) GetSummary\(\) map\[string\]interface\{\}](<#ResourceCache.GetSummary>)
  - [func \(c \*ResourceCache\) RemoveResource\(id string\) bool](<#ResourceCache.RemoveResource>)
  - [func \(c \*ResourceCache\) Stop\(\)](<#ResourceCache.Stop>)
  - [func \(c \*ResourceCache\) UpdateLastSeen\(id string, lastSeen time.Time\)](<#ResourceCache.UpdateLastSeen>)
  - [func \(c \*ResourceCache\) UpdateStatus\(id string, status string\)](<#ResourceCache.UpdateStatus>)
  - [func \(c \*ResourceCache\) UpsertResource\(resource \*model.Resource\)](<#ResourceCache.UpsertResource>)
  - [func \(c \*ResourceCache\) WarmCache\(ctx context.Context\) error](<#ResourceCache.WarmCache>)


<a name="ResourceCache"></a>
## type [ResourceCache](<https://github.com/aaronlmathis/gosight-server/blob/main/internal/cache/inmemory/cache.go#L75-L89>)

ResourceCache provides a comprehensive in\-memory caching solution for resource metadata in the GoSight monitoring system. It implements advanced indexing strategies to support efficient resource discovery, relationship tracking, and complex query operations while maintaining high\-performance concurrent access.

The cache maintains multiple specialized indexes to optimize different access patterns:

- Primary index: resource ID → resource data \(O\(1\) direct access\)
- Kind index: resource type → resources \(enables type\-based queries\)
- Group index: logical grouping → resources \(supports organizational queries\)
- Label index: label key/value pairs → resources \(enables dimensional filtering\)
- Tag index: tag key/value pairs → resources \(supports custom metadata queries\)
- Parent index: parent ID → child resources \(enables hierarchical navigation\)

Key Features:

- Thread\-safe concurrent operations with optimized read/write locking
- Automatic persistence with configurable flush intervals
- Comprehensive indexing for sub\-second query performance
- Memory\-efficient storage with automatic cleanup
- Dirty tracking for optimized persistence operations
- Batch update capabilities for high\-throughput scenarios
- Resource lifecycle management with staleness detection
- Hierarchical resource relationship tracking

The cache supports complex query patterns including:

- Multi\-dimensional label filtering with intersection semantics
- Tag\-based resource discovery and organization
- Parent\-child relationship navigation
- Resource lifecycle and status tracking
- Comprehensive resource statistics and monitoring

Architecture:

- Lock\-free read operations where possible for optimal concurrency
- Lazy index cleanup to minimize write overhead
- Background persistence with failure recovery
- Memory\-optimized data structures for large resource sets

```go
type ResourceCache struct {
    // contains filtered or unexported fields
}
```

<a name="NewResourceCache"></a>
### func [NewResourceCache](<https://github.com/aaronlmathis/gosight-server/blob/main/internal/cache/inmemory/cache.go#L108>)

```go
func NewResourceCache(store resourcestore.ResourceStore, flushInterval time.Duration) *ResourceCache
```

NewResourceCache creates and initializes a new in\-memory ResourceCache instance with comprehensive indexing and automatic persistence capabilities. The cache is immediately ready for concurrent operations and begins automatic background persistence according to the specified flush interval.

The initialization process:

- Allocates all required data structures and indexes
- Configures the persistent storage backend
- Starts the automatic flush timer for background persistence
- Establishes graceful shutdown coordination mechanisms

Parameters:

- store: The persistent storage backend for durability
- flushInterval: How frequently to persist dirty resources to storage

Returns:

- \*ResourceCache: A fully initialized cache ready for concurrent use

<a name="ResourceCache.Clear"></a>
### func \(\*ResourceCache\) [Clear](<https://github.com/aaronlmathis/gosight-server/blob/main/internal/cache/inmemory/cache.go#L672>)

```go
func (c *ResourceCache) Clear()
```

Clear removes all resources from the cache, effectively resetting it to an empty state. This method is primarily used for testing, debugging, or complete cache reinitialization scenarios.

The operation clears:

- All resource data from primary storage
- All specialized indexes
- All dirty tracking information
- All relationship mappings

Note: This operation does not affect persistent storage.

<a name="ResourceCache.DeleteResource"></a>
### func \(\*ResourceCache\) [DeleteResource](<https://github.com/aaronlmathis/gosight-server/blob/main/internal/cache/inmemory/cache.go#L437>)

```go
func (c *ResourceCache) DeleteResource(id string) bool
```



<a name="ResourceCache.GetKinds"></a>
### func \(\*ResourceCache\) [GetKinds](<https://github.com/aaronlmathis/gosight-server/blob/main/internal/cache/inmemory/cache.go#L650>)

```go
func (c *ResourceCache) GetKinds() []string
```



<a name="ResourceCache.GetResource"></a>
### func \(\*ResourceCache\) [GetResource](<https://github.com/aaronlmathis/gosight-server/blob/main/internal/cache/inmemory/cache.go#L189>)

```go
func (c *ResourceCache) GetResource(id string) (*model.Resource, bool)
```

GetResource retrieves a specific resource by its unique identifier. This method provides O\(1\) access time through the primary index and is optimized for high\-frequency individual resource lookups.

Parameters:

- id: The unique identifier of the resource to retrieve

Returns:

- \*model.Resource: The resource if found \(nil if not found\)
- bool: Whether the resource exists in the cache

<a name="ResourceCache.GetResourceCount"></a>
### func \(\*ResourceCache\) [GetResourceCount](<https://github.com/aaronlmathis/gosight-server/blob/main/internal/cache/inmemory/cache.go#L598>)

```go
func (c *ResourceCache) GetResourceCount() int
```



<a name="ResourceCache.GetResourceCountByKind"></a>
### func \(\*ResourceCache\) [GetResourceCountByKind](<https://github.com/aaronlmathis/gosight-server/blob/main/internal/cache/inmemory/cache.go#L604>)

```go
func (c *ResourceCache) GetResourceCountByKind() map[string]int
```



<a name="ResourceCache.GetResourcesByGroup"></a>
### func \(\*ResourceCache\) [GetResourcesByGroup](<https://github.com/aaronlmathis/gosight-server/blob/main/internal/cache/inmemory/cache.go#L456>)

```go
func (c *ResourceCache) GetResourcesByGroup(group string) []*model.Resource
```



<a name="ResourceCache.GetResourcesByKind"></a>
### func \(\*ResourceCache\) [GetResourcesByKind](<https://github.com/aaronlmathis/gosight-server/blob/main/internal/cache/inmemory/cache.go#L206>)

```go
func (c *ResourceCache) GetResourcesByKind(kind string) []*model.Resource
```

GetResourcesByKind retrieves all resources of a specific type/kind. This method leverages the kind index for efficient type\-based resource discovery and is commonly used for resource enumeration and type\-specific operations.

Parameters:

- kind: The resource type/kind to filter by \(e.g., "Pod", "Service", "Node"\)

Returns:

- \[\]\*model.Resource: Slice of all resources matching the kind \(nil if none found\)

<a name="ResourceCache.GetResourcesByLabels"></a>
### func \(\*ResourceCache\) [GetResourcesByLabels](<https://github.com/aaronlmathis/gosight-server/blob/main/internal/cache/inmemory/cache.go#L235>)

```go
func (c *ResourceCache) GetResourcesByLabels(labels map[string]string) []*model.Resource
```

GetResourcesByLabels performs complex multi\-dimensional filtering to find resources matching all specified label criteria. This method implements intersection semantics, returning only resources that have ALL specified label key\-value pairs.

The operation is optimized through the label index and uses progressive filtering to minimize the result set at each step, ensuring efficient performance even with large resource populations.

Parameters:

- labels: Map of label key\-value pairs that resources must match \(AND semantics\)

Returns:

- \[\]\*model.Resource: Resources matching ALL specified labels \(nil if none match\)

<a name="ResourceCache.GetResourcesByParent"></a>
### func \(\*ResourceCache\) [GetResourcesByParent](<https://github.com/aaronlmathis/gosight-server/blob/main/internal/cache/inmemory/cache.go#L540>)

```go
func (c *ResourceCache) GetResourcesByParent(parentID string) []*model.Resource
```

GetResourcesByParent retrieves all child resources for a specific parent resource, enabling hierarchical resource navigation and relationship\-based queries. This method is essential for understanding resource dependencies and implementing cascading operations.

Parameters:

- parentID: The unique identifier of the parent resource

Returns:

- \[\]\*model.Resource: All child resources of the specified parent \(nil if none\)

<a name="ResourceCache.GetResourcesByTags"></a>
### func \(\*ResourceCache\) [GetResourcesByTags](<https://github.com/aaronlmathis/gosight-server/blob/main/internal/cache/inmemory/cache.go#L485>)

```go
func (c *ResourceCache) GetResourcesByTags(tags map[string]string) []*model.Resource
```

GetResourcesByTags performs complex multi\-dimensional filtering based on custom tag metadata to find resources matching all specified tag criteria. Similar to label filtering, this method implements intersection semantics for precise resource discovery based on user\-defined metadata.

Tags provide flexible custom metadata beyond standard labels, enabling application\-specific resource organization and discovery patterns.

Parameters:

- tags: Map of tag key\-value pairs that resources must match \(AND semantics\)

Returns:

- \[\]\*model.Resource: Resources matching ALL specified tags \(nil if none match\)

<a name="ResourceCache.GetStaleResources"></a>
### func \(\*ResourceCache\) [GetStaleResources](<https://github.com/aaronlmathis/gosight-server/blob/main/internal/cache/inmemory/cache.go#L582>)

```go
func (c *ResourceCache) GetStaleResources(threshold time.Duration) []*model.Resource
```

GetStaleResources identifies resources that haven't been seen within the specified threshold duration, enabling cleanup operations and staleness detection for resource lifecycle management.

This method is commonly used for:

- Automated cleanup of disappeared resources
- Health monitoring and alerting
- Resource lifecycle analysis
- Capacity planning and optimization

Parameters:

- threshold: Maximum age before a resource is considered stale

Returns:

- \[\]\*model.Resource: All resources older than the threshold

<a name="ResourceCache.GetSummary"></a>
### func \(\*ResourceCache\) [GetSummary](<https://github.com/aaronlmathis/gosight-server/blob/main/internal/cache/inmemory/cache.go#L634>)

```go
func (c *ResourceCache) GetSummary() map[string]interface{}
```



<a name="ResourceCache.RemoveResource"></a>
### func \(\*ResourceCache\) [RemoveResource](<https://github.com/aaronlmathis/gosight-server/blob/main/internal/cache/inmemory/cache.go#L615>)

```go
func (c *ResourceCache) RemoveResource(id string) bool
```



<a name="ResourceCache.Stop"></a>
### func \(\*ResourceCache\) [Stop](<https://github.com/aaronlmathis/gosight-server/blob/main/internal/cache/inmemory/cache.go#L431>)

```go
func (c *ResourceCache) Stop()
```

Stop initiates graceful shutdown of the cache, ensuring all pending operations complete and performing a final persistence flush. This method coordinates the termination of background goroutines and ensures data consistency during shutdown.

The shutdown process:

- Signals the flush loop to terminate
- Stops the automatic flush timer
- Performs a final flush of any dirty resources
- Ensures all data is persisted before returning

<a name="ResourceCache.UpdateLastSeen"></a>
### func \(\*ResourceCache\) [UpdateLastSeen](<https://github.com/aaronlmathis/gosight-server/blob/main/internal/cache/inmemory/cache.go#L288>)

```go
func (c *ResourceCache) UpdateLastSeen(id string, lastSeen time.Time)
```

UpdateLastSeen updates the last seen timestamp for a specific resource, marking it as recently active. This method is crucial for staleness detection and resource lifecycle management, automatically marking the resource as dirty for persistence.

Parameters:

- id: The unique identifier of the resource to update
- lastSeen: The timestamp when the resource was last observed

<a name="ResourceCache.UpdateStatus"></a>
### func \(\*ResourceCache\) [UpdateStatus](<https://github.com/aaronlmathis/gosight-server/blob/main/internal/cache/inmemory/cache.go#L556>)

```go
func (c *ResourceCache) UpdateStatus(id string, status string)
```



<a name="ResourceCache.UpsertResource"></a>
### func \(\*ResourceCache\) [UpsertResource](<https://github.com/aaronlmathis/gosight-server/blob/main/internal/cache/inmemory/cache.go#L141>)

```go
func (c *ResourceCache) UpsertResource(resource *model.Resource)
```

UpsertResource adds or updates a resource in the cache, automatically maintaining all indexes and marking the resource for persistence. This method handles both new resource creation and updates to existing resources, ensuring data consistency across all indexes and optimizing for high\-frequency update scenarios.

The operation performs:

- Resource storage/update in primary index
- Preservation of CreatedAt timestamp for existing resources
- Automatic index maintenance \(removal of old, addition of new\)
- Dirty tracking for optimized persistence
- Resource update flag management

Parameters:

- resource: The resource to add or update \(must have valid ID\)

<a name="ResourceCache.WarmCache"></a>
### func \(\*ResourceCache\) [WarmCache](<https://github.com/aaronlmathis/gosight-server/blob/main/internal/cache/inmemory/cache.go#L777>)

```go
func (c *ResourceCache) WarmCache(ctx context.Context) error
```

WarmCache loads existing resources from the persistent store to populate the cache on startup. This method ensures that the cache is pre\-populated with all existing resources from the database, enabling immediate query functionality without waiting for new resource discoveries.

The warming process:

- Loads all resources from the store in batches to avoid memory pressure
- Populates all indexes for efficient querying
- Does not mark resources as dirty since they're already persisted
- Handles potential errors gracefully with appropriate logging

Parameters:

- ctx: Context for cancellation and timeout control

Returns:

- error: Any error encountered during the warming process

Generated by [gomarkdoc](<https://github.com/princjef/gomarkdoc>)
